{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
<style>
  @page {
    size: Letter;
    margin: .5in;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                 Roboto, Helvetica, Arial, sans-serif;
    font-size: 11px;
    color: #111;
  }

  h1 {
    font-size: 18px;
    margin: 6px 0 2px 0;
  }

  h2 {
    font-size: 13px;
    margin: 2px 0;
    font-weight: normal;
    color: #444;
  }

  .header {
    text-align: center;
    margin-bottom: 24px;
  }

  .header img {
    max-height: 50px;
    margin-bottom: 8px;
  }

  .meta {
    font-size: 10px;
    color: #555;
    margin-top: 6px;
  }
    .header h3 {
      font-size: 16px;
      margin: 5px 0;
      color: #4682b4;
    }

    .section {
      margin-top: 3px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }

    th {
      background-color: #f4f4f4;
    }

    .subcategory-row td:first-child {
      padding-left: 30px;
    }

    .subcategory-note {
      font-size: 9px;
      color: #777;
    }

    .summary {
      margin-top: 20px;
      font-weight: bold;
    }

    .net-amount {
      font-size: 13.5px;
      color: #2e8b57;
    }

    .footer {
      position: absolute;
      bottom: .25in;
      width: 100%;
      font-size: 10px;
      text-align: center;
      color: #777;
    }
  </style>
</head>

<body>
  {# Profit & Loss PDF Header #}
  <div class="header" style="text-align:center; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 14px;">

    {% if BRAND_LOGO_URL %}
      <img
        src="{{ BRAND_LOGO_URL }}"
        alt="{{ BRAND_PROFILE.name_for_display }} Logo"
        style="max-height: 80px; width: auto; margin-bottom: 6px;"
      >
    {% elif BRAND_PROFILE %}
      <h2 style="margin: 0;">{{ BRAND_PROFILE.name_for_display }}</h2>
    {% endif %}

    <h3 style="margin: 6px 0 4px 0;">
      Profit and Loss Statement – {{ selected_year }}
    </h3>

    {% if BRAND_PROFILE %}
      {% for line in BRAND_PROFILE.full_address_lines %}
        <p style="margin: 2px 0; font-size: 11px;">{{ line }}</p>
      {% endfor %}

      {% if BRAND_PROFILE.billing_contact_email or BRAND_PROFILE.main_phone %}
        <p style="margin: 2px 0; font-size: 11px;">
          {% if BRAND_PROFILE.billing_contact_email %}
            {{ BRAND_PROFILE.billing_contact_email }}
          {% endif %}
          {% if BRAND_PROFILE.billing_contact_email and BRAND_PROFILE.main_phone %}
            &nbsp;|&nbsp;
          {% endif %}
          {% if BRAND_PROFILE.main_phone %}
            {{ BRAND_PROFILE.main_phone }}
          {% endif %}
        </p>
      {% endif %}
    {% endif %}

  </div>


  <div class="section">
    <h4>Revenue</h4>
    <table>
      <thead>
        <tr>
          <th>Category</th>
          <th>Total Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for row in income_category_totals %}
        <tr>
          <td><strong>{{ row.category }}</strong></td>
          <td><strong>${{ row.total|floatformat:2|intcomma }}</strong></td>
        </tr>
        {% for sub_cat, amount, sched_line in row.subcategories %}
        <tr class="subcategory-row">
          <td>
            {{ sub_cat }}
            {% if sched_line %}
              <span class="subcategory-note">(Line {{ sched_line }})</span>
            {% endif %}
          </td>
          <td>${{ amount|floatformat:2|intcomma }}</td>
        </tr>
        {% endfor %}
        {% empty %}
        <tr>
          <td colspan="2">No revenue data</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td><strong>Total Revenue</strong></td>
          <td><strong>${{ income_category_total|floatformat:2|intcomma }}</strong></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <br /><br />

  <div class="section mt-5">
    <h4>
      Operating Expenses <br>
      <span style="font-weight: normal; font-size: 10px;">
        (Notes: meals are 50% of actual; Fuel is Rental Car Fuel Charges)
      </span>
    </h4>
    <table>
      <thead>
        <tr>
          <th>Category</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for row in expense_category_totals %}
        <tr>
          <td><strong>{{ row.category }}</strong></td>
          <td><strong>-${{ row.total|floatformat:2|intcomma }}</strong></td>
        </tr>
        {% for sub_cat, amount, sched_line in row.subcategories %}
        <tr class="subcategory-row">
          <td>
            {{ sub_cat }}
          </td>
          <td>-${{ amount|floatformat:2|intcomma }}</td>
        </tr>
        {% endfor %}
        {% empty %}
        <tr>
          <td colspan="2">No deductible expense data</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td><strong>Total Expenses</strong></td>
          <td><strong>-${{ expense_category_total|floatformat:2|intcomma }}</strong></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="summary" style="float: right; margin-top: 20px; margin-right: 10em;">
    <p>Net Profit/Loss: <strong>${{ net_profit|floatformat:2|intcomma }}</strong></p>
  </div>

  <div class="footer">
    &copy; {{ selected_year }} Airborne Images &nbsp;•&nbsp; {{ now|date:"F j, Y" }}
  </div>
</body>
</html>
