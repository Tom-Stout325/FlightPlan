{% load static %}



<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>CONOPS – {{ planning.operation_title }}</title>

  <link rel="stylesheet" href="{% static 'styles/conops_pdf.css' %}">
  <style>
      /* Page setup */
    @page {
      size: Letter;
      margin: 0.85in;
    }

    * { box-sizing: border-box; }

    body {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 11.5pt;
      line-height: 1.35;
      color: #111;
    }

    h1, h2, h3 {
      margin: 0 0 0.35rem 0;
      line-height: 1.15;
    }

    .cover {
      padding-top: .25in;
    }

    .cover-top {
      text-align: center;
    }

    .cover-top img.logo {
      display: block;
      margin: 0 auto 1rem auto;
    }


    .cover-meta {
      margin-top: .25rem;
      font-size: 11pt;
      text-align: center;
    }

    .label {
      font-weight: bold;
    }

    .logo {
      width: 200px;
      height: auto;
    }

    .cover,
    .toc {
      page-break-inside: avoid;
    } 
    .toc h3 {
      font-size: 16pt;
      margin-bottom: 0.75rem;
    }

    .toc ol {
      margin: 0;
      padding-left: 1.25rem;
    }

    .toc li {
      margin: 0.25rem 0;
    }

    .toc-note {
      margin-top: 1rem;
      font-size: 10.5pt;
    }

    .section-title {
      font-size: 16pt;
      margin-bottom: 0.6rem;
      padding-bottom: 0.25rem;
      border-bottom: 1px solid #ddd;
    }

    .section-body p {
      margin: 0 0 0.55rem 0;
    }

    .muted {
      color: #666;
    }

    /* page breaks */
    .page-break {
      page-break-after: always;
    }

    /* Avoid ugly breaks in critical blocks */
    .section,
    .cover,
    .toc {
      page-break-inside: avoid;
    }
    .cover-badge{
      display:inline-block;
      margin-top: .35rem;
      padding: .18rem .55rem;
      border: 1px solid #bbb;
      border-radius: 999px;
      font-size: 9.5pt;
      letter-spacing: .02em;
      color: #333;
    }
    .badge-controlled {
      display: inline-block;
      margin-left: 8pt;
      padding: 2pt 6pt;
      font-size: 9pt;
      font-weight: 600;
      border-radius: 10pt;
      border: 1pt solid #0d6efd;
      color: #0d6efd;
      background-color: #e7f1ff;
      vertical-align: middle;
    }

    </style>
</head>
<body>

  <!-- COVER -->
  <div class="cover">


    <div class="cover-top">
      <img src="{% static 'images/logo2.png' %}" class="logo" alt="{{ BRAND.name }} Logo">
      <h1>
        Concept of Operations
        {% with ac=planning.airspace_class|default:""|upper %}
          {% if ac in "BCDE" %}
            <span class="badge-controlled">
              Controlled Airspace Operations
            </span>
          {% endif %}
        {% endwith %}
      </h1>

      <h3>(CONOPS)</h3>
      <h2>{{ planning.operation_title }}</h2>
      {% if planning.airspace_class in "BCD E" or planning.airspace_class in "BCDE" %}
        <div class="cover-badge">Controlled Airspace Operations</div>
      {% endif %}
    </div>

    <div class="cover-meta">
      <div><span class="label">Applicant:</span> {{ request_user.get_full_name|default:request_user.username }}</div>
      {% if planning.street_address or planning.zip_code %}
        <div><span class="label">Location:</span>
          {{ planning.street_address }}{% if planning.zip_code %}, {{ planning.zip_code }}{% endif %}
        </div>
      {% endif %}
    </div>
  </div>

  <!-- TABLE OF CONTENTS -->
  <div class="toc">
    <h3>Table of Contents</h3>
    <ol>
      {% for section in sections %}
        <li>{{ section.title }}</li>
      {% endfor %}
    </ol>
    <p class="toc-note">
      This CONOPS provides operational and safety details supporting a FAA Part 107 waiver application.
    </p>
  </div>

  <div class="page-break"></div>

  <!-- SECTIONS -->
{% for section in sections %}
  <div class="section">
    <h2 class="section-title">{{ forloop.counter }}. {{ section.title }}</h2>

    <div class="section-body">
        {% if section.key == "cover_page" %}

          <p><strong>Operation Title:</strong> {{ planning.operation_title|default:"TBD" }}</p>
          <p><strong>Venue:</strong> {{ planning.venue_name|default:"TBD" }}</p>
          <p><strong>Airspace Classification:</strong> {{ planning.airspace_class|default:"TBD" }}</p>
          <p><strong>Unmanned Aircraft System:</strong> {{ planning.aircraft_display|default:"TBD" }}</p>
          <p><strong>Remote Pilot in Command:</strong> {{ planning.pilot_display_name|default:"TBD" }}</p>
          <p><strong>Part 107 Certificate Number:</strong> {{ planning.pilot_cert_display|default:"TBD" }}</p>
          <p><strong>Approximate UAS Flight Hours:</strong> {{ planning.pilot_flight_hours|default:"TBD" }}</p>
          <p><strong>Nearest Airport:</strong>
            {% if planning.nearest_airport_ref %}
              {{ planning.nearest_airport_ref.icao }} – {{ planning.nearest_airport_ref.name }}
            {% else %}
              {{ planning.nearest_airport|default:"TBD" }}
            {% endif %}
          </p>
          <p> <strong>Distance to Airport (NM):</strong>
            {{ planning.distance_to_airport_nm|default:"TBD" }}
          </p>
        {% else %}
        {% if section.obj and section.obj.content %}
          {{ section.obj.content|linebreaks }}
        {% elif section.content %}
          {{ section.content|linebreaks }}
        {% else %}
          <p class="muted">No content available for this section.</p>
        {% endif %}
      {% endif %}
    </div>
  </div>
{% endfor %}



</body>
</html>
